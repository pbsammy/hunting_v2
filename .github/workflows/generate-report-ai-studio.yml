name: Generate Threat Hunt Report

on:
  workflow_dispatch:
    inputs:
      threat_name:
        description: 'Name of the threat or vulnerability (e.g., Whisper Leak, Log4Shell)'
        required: true
      mitre_attack_id:
        description: 'MITRE ATT&CK ID (e.g., T1578)'
        required: false
        default: 'N/A'
      threat_description:
        description: 'Detailed description of the threat.'
        required: true
      attack_vector:
        description: 'The attack vector (how the attack works).'
        required: true
      detection_hypothesis:
        description: 'Hypothesis for detecting this activity.'
        required: true
      resources:
        description: 'Comma-separated list of resource URLs.'
        required: false
      output_filename:
        description: 'Name of the output report file'
        required: true
        default: 'threat_hunt_report.md'

jobs:
  generate-report:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install google-generativeai

    - name: Generate Report
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: |
        python main_ai_studio.py \
          --threat-name "${{ github.event.inputs.threat_name }}" \
          --mitre-attack-id "${{ github.event.inputs.mitre_attack_id }}" \
          --threat-description "${{ github.event.inputs.threat_description }}" \
          --attack-vector "${{ github.event.inputs.attack_vector }}" \
          --detection-hypothesis "${{ github.event.inputs.detection_hypothesis }}" \
          --resources "${{ github.event.inputs.resources }}" \
          --output "${{ github.event.inputs.output_filename }}"

    - name: Upload Report Artifact
      uses: actions/upload-artifact@v3
      with:
        name: threat-hunt-report
        path: ${{ github.event.inputs.output_filename }}
